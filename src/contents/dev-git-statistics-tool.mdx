---
title: Git ç»Ÿè®¡å·¥å…·
category:
  - DevTools
slug: dev-git-statistics-tool
summary: æ”¶é›† Git ç›¸å…³çš„ç»Ÿè®¡å·¥å…·ã€‚
createdTime: '2025-11-12 16:41:59'
updatedTime: '2025-11-12 16:54:26'
---

```js title="git-stats.js"
import { execSync } from 'child_process';

/**
 * æ‰§è¡Œ git å‘½ä»¤å¹¶è¿”å›ç»“æœ
 */
function execGitCommand(command) {
  try {
    return execSync(command, { encoding: 'utf-8', cwd: process.cwd() });
  } catch (error) {
    console.error(`âŒ Error executing git command: ${command}`);
    console.error(error.message);
    process.exit(1);
  }
}

/**
 * è§£æ git log --numstat è¾“å‡ºï¼ˆå¸¦é‡å¤æ£€æµ‹ï¼‰
 */
function parseGitStats(options = {}) {
  const { excludeMerges = false, showDetails = false } = options;

  // æ’é™¤åˆå¹¶æäº¤å¯ä»¥é¿å…é‡å¤è®¡ç®—
  const mergeOption = excludeMerges ? '--no-merges' : '';
  const command = `git log ${mergeOption} --numstat --pretty=format:"%H|||%an|||%ae|||%s"`;
  const output = execGitCommand(command);
  const lines = output.trim().split('\n');

  const stats = {};
  const fileStats = {}; // ç”¨äºè·Ÿè¸ªæ–‡ä»¶è¢«ç»Ÿè®¡çš„æ¬¡æ•°
  let currentAuthor = null;
  let currentCommit = null;

  for (const line of lines) {
    // æ£€æŸ¥æ˜¯å¦æ˜¯æäº¤ä¿¡æ¯è¡Œï¼ˆåŒ…å« ||| åˆ†éš”ç¬¦ï¼‰
    if (line.includes('|||')) {
      const parts = line.split('|||');
      if (parts.length >= 4) {
        currentCommit = parts[0].trim();
        const name = parts[1].trim();
        const email = parts[2].trim();
        currentAuthor = name;

        if (!stats[currentAuthor]) {
          stats[currentAuthor] = {
            name: currentAuthor,
            email: email,
            added: 0,
            deleted: 0,
            files: 0,
            commits: new Set(), // è·Ÿè¸ªæäº¤æ•°
            fileChanges: {}, // è·Ÿè¸ªæ¯ä¸ªæ–‡ä»¶çš„å˜æ›´æ¬¡æ•°
          };
        }
        stats[currentAuthor].commits.add(currentCommit);
      }
      continue;
    }

    // è§£ææ–‡ä»¶å˜æ›´ç»Ÿè®¡ï¼ˆæ ¼å¼ï¼šadded deleted filenameï¼‰
    if (currentAuthor && line.trim()) {
      const parts = line.split('\t');
      if (parts.length >= 3) {
        const added = parseInt(parts[0], 10) || 0;
        const deleted = parseInt(parts[1], 10) || 0;
        const filename = parts[2].trim();

        stats[currentAuthor].added += added;
        stats[currentAuthor].deleted += deleted;
        stats[currentAuthor].files += 1;

        // è·Ÿè¸ªæ–‡ä»¶ç»Ÿè®¡æ¬¡æ•°
        const fileKey = `${currentAuthor}:${filename}`;
        if (!fileStats[fileKey]) {
          fileStats[fileKey] = {
            author: currentAuthor,
            filename: filename,
            count: 0,
            totalAdded: 0,
            totalDeleted: 0,
            commits: [],
          };
        }
        fileStats[fileKey].count += 1;
        fileStats[fileKey].totalAdded += added;
        fileStats[fileKey].totalDeleted += deleted;
        fileStats[fileKey].commits.push(currentCommit);

        // è·Ÿè¸ªæ¯ä¸ªä½œè€…çš„æ–‡ä»¶å˜æ›´æ¬¡æ•°
        if (!stats[currentAuthor].fileChanges[filename]) {
          stats[currentAuthor].fileChanges[filename] = 0;
        }
        stats[currentAuthor].fileChanges[filename] += 1;
      }
    }
  }

  return { stats, fileStats };
}

/**
 * æ£€æµ‹é‡å¤ç»Ÿè®¡çš„æ–‡ä»¶
 */
function detectDuplicates(fileStats) {
  const duplicates = [];

  for (const [key, fileStat] of Object.entries(fileStats)) {
    if (fileStat.count > 1) {
      duplicates.push({
        ...fileStat,
        key,
      });
    }
  }

  return duplicates.sort((a, b) => b.count - a.count);
}

/**
 * æ ¼å¼åŒ–è¾“å‡ºç»Ÿè®¡ç»“æœ
 */
function formatStats({ stats, fileStats }, options = {}) {
  const { showDetails = false, showDuplicates = false } = options;

  const authors = Object.values(stats).sort((a, b) => b.added + b.deleted - (a.added + a.deleted));

  console.log('\nğŸ“Š Git ä»£ç ç»Ÿè®¡ï¼ˆæŒ‰ä½œè€…åˆ†ç±»ï¼‰\n');
  console.log('='.repeat(80));

  let totalAdded = 0;
  let totalDeleted = 0;
  let totalFiles = 0;
  let totalCommits = 0;

  for (const author of authors) {
    const total = author.added + author.deleted;
    totalAdded += author.added;
    totalDeleted += author.deleted;
    totalFiles += author.files;
    totalCommits += author.commits.size;

    console.log(`\nğŸ‘¤ ${author.name}`);
    console.log(`   ğŸ“§ ${author.email}`);
    console.log(`   â• æ–°å¢è¡Œæ•°: ${author.added.toLocaleString()}`);
    console.log(`   â– åˆ é™¤è¡Œæ•°: ${author.deleted.toLocaleString()}`);
    console.log(`   ğŸ“ ä¿®æ”¹æ–‡ä»¶æ•°: ${author.files.toLocaleString()}`);
    console.log(`   ğŸ“ˆ æ€»è®¡å˜æ›´: ${total.toLocaleString()} è¡Œ`);
    console.log(`   ğŸ”¢ æäº¤æ¬¡æ•°: ${author.commits.size}`);

    // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
    if (showDetails) {
      const fileChangeEntries = Object.entries(author.fileChanges)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10); // åªæ˜¾ç¤ºå‰10ä¸ªè¢«ä¿®æ”¹æœ€å¤šæ¬¡çš„æ–‡ä»¶

      if (fileChangeEntries.length > 0) {
        console.log(`   ğŸ“‹ è¢«ä¿®æ”¹æœ€å¤šæ¬¡çš„æ–‡ä»¶ï¼ˆå‰10ï¼‰:`);
        for (const [filename, count] of fileChangeEntries) {
          console.log(`      - ${filename}: ${count} æ¬¡`);
        }
      }
    }
  }

  console.log('\n' + '='.repeat(80));
  console.log('\nğŸ“‹ æ€»è®¡ç»Ÿè®¡');
  console.log(`   â• æ€»æ–°å¢è¡Œæ•°: ${totalAdded.toLocaleString()}`);
  console.log(`   â– æ€»åˆ é™¤è¡Œæ•°: ${totalDeleted.toLocaleString()}`);
  console.log(`   ğŸ“ æ€»ä¿®æ”¹æ–‡ä»¶æ•°: ${totalFiles.toLocaleString()}`);
  console.log(`   ğŸ“ˆ æ€»å˜æ›´è¡Œæ•°: ${(totalAdded + totalDeleted).toLocaleString()}`);
  console.log(`   ğŸ”¢ æ€»æäº¤æ¬¡æ•°: ${totalCommits.toLocaleString()}`);
  console.log(`   ğŸ‘¥ è´¡çŒ®è€…æ•°é‡: ${authors.length}`);

  // æ˜¾ç¤ºé‡å¤ç»Ÿè®¡çš„æ–‡ä»¶
  if (showDuplicates) {
    const duplicates = detectDuplicates(fileStats);
    if (duplicates.length > 0) {
      console.log('\n' + '='.repeat(80));
      console.log('\nâš ï¸  æ£€æµ‹åˆ°å¯èƒ½é‡å¤ç»Ÿè®¡çš„æ–‡ä»¶ï¼ˆè¢«ç»Ÿè®¡å¤šæ¬¡ï¼‰\n');
      console.log('å‰20ä¸ªè¢«ç»Ÿè®¡æœ€å¤šæ¬¡çš„æ–‡ä»¶ï¼š\n');

      duplicates.slice(0, 20).forEach((dup, index) => {
        console.log(`${index + 1}. ${dup.filename}`);
        console.log(`   ä½œè€…: ${dup.author}`);
        console.log(`   è¢«ç»Ÿè®¡æ¬¡æ•°: ${dup.count}`);
        console.log(`   ç´¯è®¡æ–°å¢: ${dup.totalAdded.toLocaleString()}`);
        console.log(`   ç´¯è®¡åˆ é™¤: ${dup.totalDeleted.toLocaleString()}`);
        console.log(`   æ¶‰åŠçš„æäº¤: ${dup.commits.length} ä¸ª`);
        console.log('');
      });
    } else {
      console.log('\nâœ… æœªæ£€æµ‹åˆ°æ˜æ˜¾çš„é‡å¤ç»Ÿè®¡');
    }
  }

  console.log('\n');
}

/**
 * ä¸»å‡½æ•°
 */
function main() {
  try {
    const args = process.argv.slice(2);
    const excludeMerges = args.includes('--no-merges');
    const showDetails = args.includes('--details');
    const showDuplicates = args.includes('--duplicates');

    if (args.includes('--help') || args.includes('-h')) {
      console.log(`
ç”¨æ³•: node git-stats.js [é€‰é¡¹]

é€‰é¡¹:
  --no-merges    æ’é™¤åˆå¹¶æäº¤ï¼ˆæ¨èï¼Œé¿å…é‡å¤è®¡ç®—ï¼‰
  --details      æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆæ¯ä¸ªä½œè€…è¢«ä¿®æ”¹æœ€å¤šæ¬¡çš„æ–‡ä»¶ï¼‰
  --duplicates   æ£€æµ‹å¹¶æ˜¾ç¤ºå¯èƒ½é‡å¤ç»Ÿè®¡çš„æ–‡ä»¶
  --help, -h     æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯

ç¤ºä¾‹:
  node git-stats.js --no-merges --duplicates
  node git-stats.js --details
      `);
      return;
    }

    console.log('ğŸš€ å¼€å§‹ç»Ÿè®¡ Git ä»£ç è´¡çŒ®...\n');
    if (excludeMerges) {
      console.log('â„¹ï¸  å·²å¯ç”¨ï¼šæ’é™¤åˆå¹¶æäº¤ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰\n');
    }

    const result = parseGitStats({ excludeMerges });
    formatStats(result, { showDetails, showDuplicates });
  } catch (error) {
    console.error('âŒ ç»Ÿè®¡è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error.message);
    process.exit(1);
  }
}

// æ‰§è¡Œç»Ÿè®¡
main();
```

ç¤ºä¾‹ï¼š

```bash
node git-stats.js --no-merges --duplicates
node git-stats.js --details
```
